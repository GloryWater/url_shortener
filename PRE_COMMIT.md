# Pre-commit —Ö—É–∫–∏

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### Windows
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
.\scripts\install-pre-commit.bat
```

### Linux/macOS
```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x scripts/install-pre-commit.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
./scripts/install-pre-commit.sh
```

### –í—Ä—É—á–Ω—É—é
```bash
uv run pre-commit install
```

---

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ pre-commit —Ö—É–∫–æ–≤, **–ø—Ä–∏ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ `git commit`** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. ‚úÖ **Ruff check** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. ‚úÖ **Ruff format** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
3. ‚úÖ **MyPy** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (—Ç–æ–ª—å–∫–æ `src/`)

–ï—Å–ª–∏ **–ª—é–±–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç**, –∫–æ–º–º–∏—Ç **–æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è** –∏ –≤—ã –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É.

---

## üîß –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û–±—ã—á–Ω—ã–π –∫–æ–º–º–∏—Ç (—Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏)
```bash
git add .
git commit -m "Add new feature"
```

–ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```
ruff.....................................................................Failed
- hook id: ruff
- files were modified by this hook

Found 2 errors (2 fixed, 0 remaining).
```

Ruff –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç –æ—à–∏–±–∫–∏ –∏ –ø–æ–∫–∞–∂–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `git commit` —Å–Ω–æ–≤–∞.

### –ö–æ–º–º–∏—Ç –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)
```bash
git commit --no-verify -m "Hotfix"
```

‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö!**

---

## üìù –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
```bash
uv run pre-commit run --all-files
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```bash
uv run pre-commit run
```

### –£–¥–∞–ª–∏—Ç—å pre-commit —Ö—É–∫–∏
```bash
uv run pre-commit uninstall
```

---

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

Pre-commit **–Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ (—ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ).

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
uv run pytest

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
uv run pytest --cov=src --cov-fail-under=80

# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
uv run pytest -v
```

---

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.pre-commit-config.yaml`.

### –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å:
```python
# flake8: noqa
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω –≤ `.pre-commit-config.yaml`:
```yaml
- id: mypy
  exclude: ^tests/
```

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "pre-commit: command not found"
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pre-commit:
```bash
uv pip install pre-commit
```

### "mypy has no attribute 'op'"
–≠—Ç–æ –æ—à–∏–±–∫–∞ –≤ alembic —Ñ–∞–π–ª–∞—Ö. –î–æ–±–∞–≤—å—Ç–µ:
```python
from alembic import op  # type: ignore[attr-defined]
```

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞
Ruff format –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–¥. –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–º–∏—Ç–∞:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `git add .`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `git commit` —Å–Ω–æ–≤–∞

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Pre-commit –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pre-commit.com/)
- [Ruff –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.astral.sh/ruff/)
- [MyPy –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://mypy.readthedocs.io/)
